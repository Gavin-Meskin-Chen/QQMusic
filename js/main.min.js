function loadMusicScript(){if("undefined"!=typeof localMusic&&Array.isArray(localMusic)&&0!==localMusic.length){e=document.createElement("script");e.src="./js/localEngine.js",document.body.appendChild(e),local=!0}else{var e=document.createElement("script");e.src="./js/Meting.js",document.body.appendChild(e)}}function handScrollFunc(e){handScrollFlag=0,clearTimeout(handScrollTime),handScrollTime=setTimeout(()=>{handScrollFlag=1,heo.scrollLyric()},3e3)}console.log("\n %c HeoMusic 开源静态音乐播放器 %c https://github.com/zhheo/HeoMusic \n","color: #fadfa3; background: #030307; padding:5px 0;","background: #fadfa3; padding:5px 0;");var local=!1;let handScrollFlag=1,handScrollTime=null;if(void 0===userId)var userId="";if(void 0===userServer)var userServer="";if(void 0===userType)var userType="";"undefined"!=typeof remoteMusic&&remoteMusic?fetch(remoteMusic).then(e=>e.json()).then(e=>{Array.isArray(e)&&(localMusic=e),loadMusicScript()}).catch(e=>{console.error("Error fetching remoteMusic:",e),loadMusicScript()}):loadMusicScript();var volume=.8;const params=new URLSearchParams(window.location.search);var heo={scrollLyric:function(){const e=document.querySelector(".aplayer-lrc"),t=document.querySelector(".aplayer-lrc-current");if(e&&t){let n=e.scrollTop,r=t.offsetTop-.3*(window.innerHeight-150),i=r-n,s=600,c=null;function a(e){return e*(2-e)}function o(t){null===c&&(c=t);let r=t-c,l=Math.min(r/s,1),d=window.innerWidth<768?l:a(l);e.scrollTop=n+i*d,r<s&&requestAnimationFrame(o)}requestAnimationFrame(o)}},getCustomPlayList:function(){const e=document.getElementById("heoMusic-page"),t=params.get("type")||"playlist";if(params.get("id")&&params.get("server")){console.log("获取到自定义内容");var a=params.get("id"),o=params.get("server");e.innerHTML=`<meting-js id="${a}" server="${o}" type="${t}" mutex="true" preload="auto" order="random"></meting-js>`}else console.log("无自定义内容"),e.innerHTML=`<meting-js id="${userId}" server="${userServer}" type="${userType}" mutex="true" preload="auto" order="random"></meting-js>`},bindEvents:function(){var e=this;this.lrc&&this.template.lrc.addEventListener("click",function(t){var a=t.target;if("p"===a.tagName.toLowerCase())for(var o=e.template.lrc.getElementsByTagName("p"),n=0;n<o.length;n++)if(o[n]===a){if(e.lrc.current[n]){var r=e.lrc.current[n][0];e.seek(r),e.paused&&e.play()}break}})},addLyricClickEvent:function(){const e=document.querySelector(".aplayer-lrc-contents");e&&e.addEventListener("click",function(t){if("p"===t.target.tagName.toLowerCase()){const a=e.getElementsByTagName("p");for(let e=0;e<a.length;e++)if(a[e]===t.target){const a=ap;if(a.lrc.current[e]){const t=a.lrc.current[e][0];a.seek(t),a.paused&&a.play()}t.stopPropagation();break}}})},setMediaMetadata:function(e,t){const a=e.list.audios[e.list.index],o=a.cover||"./img/icon.webp",n=document.getElementById("heoMusic-page").querySelector(".aplayer-lrc-current").textContent;let r,i;"mediaSession"in navigator?(t&&n?(r=n,i=`${a.artist} | ${a.name}`):(r=a.name,i=a.artist),navigator.mediaSession.metadata=new MediaMetadata({title:r,artist:i,album:a.album,artwork:[{src:o,sizes:"96x96",type:"image/jpeg"},{src:o,sizes:"128x128",type:"image/jpeg"},{src:o,sizes:"192x192",type:"image/jpeg"},{src:o,sizes:"256x256",type:"image/jpeg"},{src:o,sizes:"384x384",type:"image/jpeg"},{src:o,sizes:"512x512",type:"image/jpeg"}]})):(console.log("当前浏览器不支持 Media Session API"),document.title=`${a.name} - ${a.artist}`)},setupMediaSessionHandlers:function(e){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",()=>{e.play()}),navigator.mediaSession.setActionHandler("pause",()=>{e.pause()}),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",()=>{e.skipBack()}),navigator.mediaSession.setActionHandler("nexttrack",()=>{e.skipForward()}),navigator.mediaSession.setActionHandler("seekto",t=>{t.fastSeek&&"fastSeek"in e.audio?e.audio.fastSeek(t.seekTime):e.audio.currentTime=t.seekTime}),e.on("loadeddata",()=>{heo.setMediaMetadata(e,!1)}),e.on("play",()=>{"mediaSession"in navigator&&(navigator.mediaSession.playbackState="playing",heo.setMediaMetadata(e,!0))}),e.on("pause",()=>{"mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused",heo.setMediaMetadata(e,!1))}),e.on("timeupdate",()=>{heo.setMediaMetadata(e,!0)}))},updateThemeColorWithImage(e){if(local){const t=t=>{const a=t.getColor(e),o=document.querySelector('meta[name="theme-color"]');if(o){const e=Math.round(.6*a[0]),t=Math.round(.6*a[1]),n=Math.round(.6*a[2]);o.setAttribute("content",`rgb(${e},${t},${n})`)}};if("undefined"==typeof ColorThief){const e=document.createElement("script");e.src="./js/color-thief.min.js",e.onload=(()=>t(new ColorThief)),document.body.appendChild(e)}else t(new ColorThief)}}};document.addEventListener("keydown",function(e){"Space"===e.code&&(e.preventDefault(),ap.toggle()),39===e.keyCode&&(e.preventDefault(),ap.skipForward()),37===e.keyCode&&(e.preventDefault(),ap.skipBack()),38===e.keyCode&&volume<=1&&(volume+=.1,ap.volume(volume,!0)),40===e.keyCode&&volume>=0&&(volume+=-.1,ap.volume(volume,!0))}),window.addEventListener("resize",function(){window.innerWidth>768?ap.list.show():ap.list.hide()}),window.onload=function(){document.querySelector(".aplayer-lrc").addEventListener("wheel",handScrollFunc,{passive:!1}),document.querySelector(".aplayer-lrc").addEventListener("touchmove",handScrollFunc,{passive:!1})},heo.getCustomPlayList();